<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Multi-Process dplyr Backend • multidplyr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="A Multi-Process dplyr Backend">
<meta property="og:description" content="Partition a data frame across multiple worker processes in to
    provide simple multicore parallelism.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="index.html">multidplyr</a>
        <div class="info">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/multidplyr.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/multidplyr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="multidplyr" class="section level1">

<!-- badges: start -->

<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>multidplyr is a backend for dplyr that partitions a data frame across multiple cores. You tell multidplyr how to split the data up with <code><a href="reference/partition.html">partition()</a></code> and then the data stays on each node until you explicitly retrieve it with <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code>. This minimises the amount of time spent moving data around, and maximises parallel performance. This idea is inspired by <a href="http://bit.ly/1Nve8v5">partools</a> by Norm Matloff and <a href="https://github.com/vertica/DistributedR">distributedR</a> by the Vertica Analytics team.</p>
<p>Due to the overhead associated with communicating between the nodes, you won’t see much performance improvement on basic dplyr verbs with less than ~10 million observations, and you may want to try <a href="http://dtplyr.tidyverse.org/">dtplyr</a>, which uses <a href="http://R-datatable.com/">data.table</a> instead. multidplyr’s strength is conveniently parallelising the type of more complex operation often found in <code><a href="https://dplyr.tidyverse.org/reference/do.html">do()</a></code>.</p>
<p>(Note that unlike other packages in the tidyverse, multidplyr requires R 3.5 or greater. We hope to relax this requirement <a href="https://github.com/traversc/qs/issues/11">in the future</a>.)</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>To install from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">"tidyverse/multidplyr"</span>)</a></code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>To use multidplyr, you first create a cluster of the desired number of workers. Each one of these workers is a separate R process, and the operating system will spread their execution across multiple cores:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(multidplyr)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">cluster &lt;-<span class="st"> </span><span class="kw"><a href="reference/new_cluster.html">new_cluster</a></span>(<span class="dv">4</span>)</a></code></pre></div>
<p>There are two primary ways to use multidplyr. The first, and most, efficient is to load a different data on each worker:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Create a filename vector containing different values on each worker</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="reference/cluster_utils.html">cluster_assign_each</a></span>(cluster, <span class="dt">filename =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a.csv"</span>, <span class="st">"b.csv"</span>, <span class="st">"c.csv"</span>, <span class="st">"d.csv"</span>))</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># Use vroom to quickly load the csvs</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw"><a href="reference/cluster_call.html">cluster_send</a></span>(cluster, my_data &lt;-<span class="st"> </span>vroom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/vroom/man/vroom.html">vroom</a></span>(filename))</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># Create a party_df using the my_data variable on each worker</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">my_data &lt;-<span class="st"> </span><span class="kw"><a href="reference/party_df.html">party_df</a></span>(cluster, <span class="st">"my_data"</span>)</a></code></pre></div>
<p>Alternatively, if you already have the data loaded in the main session, you can use <code><a href="reference/partition.html">partition()</a></code> to automatically spread it across workers. Use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> to ensure that all of the observations belonging to a group end up on the same worker.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">flight_dest &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(dest) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="reference/partition.html">partition</a></span>(cluster)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">flight_dest</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; Source: party_df [336,776 x 19]</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; Groups: dest</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; Shards: 4 [81,594--86,548 rows]</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 1  2013     1     1      544            545        -1     1004</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; 2  2013     1     1      558            600        -2      923</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; 3  2013     1     1      559            600        -1      854</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; 4  2013     1     1      602            610        -8      812</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; 5  2013     1     1      602            605        -3      821</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; 6  2013     1     1      611            600        11      945</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; # … with 3.368e+05 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></a></code></pre></div>
<p>Now you can work with it like a regular data frame, but the computations will be spread across multiple cores. Once you’ve finished computation, use <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code> to bring the data back to the host session:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">flight_dest <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">delay =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">n =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span>()</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; # A tibble: 105 x 3</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;    dest  delay     n</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  1 ABQ    13.7   254</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  2 AUS    13.0  2439</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  3 BQN    12.4   896</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;  4 BTV    13.6  2589</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;  5 BUF    13.4  4681</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;  6 CLE    13.4  4573</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;  7 CMH    12.2  3524</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt;  8 DEN    15.2  7266</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;  9 DSM    26.2   569</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; 10 DTW    11.8  9384</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; # … with 95 more rows</span></a></code></pre></div>
<p>Note that there is some overhead associated with copying data from the worker nodes back to the host node (and vice versa), so you’re best off using multidplyr with more complex operations. See <code><a href="articles/multidplyr.html">vignette("multidplyr")</a></code> for more details.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/tidyverse/multidplyr">https://​github.com/​tidyverse/​multidplyr</a>
</li>
<li>Report a bug at <br><a href="https://github.com/tidyverse/multidplyr/issues">https://​github.com/​tidyverse/​multidplyr/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://hadley.nz">Hadley Wickham</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://travis-ci.org/tidyverse/multidplyr"><img src="https://travis-ci.org/tidyverse/multidplyr.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/gh/tidyverse/multidplyr?branch=master"><img src="https://codecov.io/gh/tidyverse/multidplyr/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://cran.r-project.org/package=multidplyr"><img src="https://www.r-pkg.org/badges/version/multidplyr" alt="CRAN status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="tidyverse">
  <p>multidplyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href="http://hadley.nz">Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
